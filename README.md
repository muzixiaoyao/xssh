# xssh —— 基于 CSV 的 SSH 密码快速连接工具

`xssh` 是一个用于 **SSH 密码登录的命令行工具**，用于在不使用 SSH Key 的情况下，实现 **像 `ssh` 一样的快速连接体验**。

它将所有需要使用密码登录的主机信息，统一存储在本地 `~/.ssh/hosts.csv` 文件中，并通过 `user@host` 的方式进行唯一定位。

---

## 一、设计目标

* 🚀 快速 SSH 登录，无需手输密码
* 🧾 主机信息统一管理（CSV）
* 👥 支持同一主机多个用户
* 🔒 不修改系统 SSH 行为，不侵入配置
* 🛠️ 面向运维 / 批量管理场景

---

## 二、核心特性

* 使用方式与 `ssh` 基本一致
* 主机凭据集中存储在 `hosts.csv`
* 以 `用户名@主机名(IP)` 作为唯一索引
* 支持交互式用户选择
* 明确、可控的行为边界（不自动做“聪明事”）

---

## 三、文件结构约定

### 1️⃣ hosts.csv 存放位置

```text
默认: ~/.ssh/hosts.csv
自定义: 使用 -i 参数指定
```

示例：

```bash
# 使用默认配置
xssh root@192.168.1.1

# 使用自定义配置文件
xssh -i /path/to/hosts.csv root@192.168.1.1
```

---

### 2️⃣ hosts.csv 字段定义

CSV 文件必须包含以下字段（顺序固定）：

| 字段名      | 说明           |
| -------- | ------------ |
| host     | 主机名或 IP      |
| port     | SSH 端口       |
| user     | SSH 用户名      |
| password | SSH 登录密码（明文） |

---

### 3️⃣ 唯一性约束

```text
(host, user) 必须唯一
```

* 同一台主机 **可以有多个用户**
* 同一主机 **同一用户不能重复**

---

### 4️⃣ 示例 hosts.csv

```csv
host,port,user,password
192.168.1.1,22,root,Root@123
192.168.1.1,22,dev,Dev@123
10.10.10.5,2222,admin,Admin@456
```

---

## 四、基本使用方法

### 1️⃣ 标准用法（推荐）

```bash
xssh root@192.168.1.1
```

行为说明：

* 在 `hosts.csv` 中查找：

  * host = `192.168.1.1`
  * user = `root`
* 使用 CSV 中配置的端口和密码进行 SSH 登录

---

### 2️⃣ 指定端口（可选）

```bash
xssh root@192.168.1.1:2222
```

规则：

* 命令行端口 **优先级高于 CSV**
* 仅用于本次连接，不会修改 hosts.csv

---

### 3️⃣ 仅指定主机（用户自动匹配）

```bash
xssh 192.168.1.1
```

行为：

* 如果该主机只有一个用户 → 自动登录
* 如果存在多个用户 → 进入交互选择

示例：

```text
发现多个用户：
[1] root
[2] dev
请选择用户：
```

---

## 五、主机管理命令

### 1️⃣ 添加主机信息

```bash
xssh add [-i config] user@host[:port]
```

功能：
* 交互式输入密码
* 自动添加到配置文件
* 自动创建文件（如果不存在）

示例：

```bash
# 使用默认配置
xssh add root@192.168.1.1:2222

# 使用自定义配置
xssh add -i /path/to/hosts.csv root@192.168.1.1
```

---

### 2️⃣ 删除主机信息

```bash
xssh delete [-i config] user@host
```

功能：
* 删除指定的主机记录
* 需要同时指定用户和主机

示例：

```bash
# 使用默认配置
xssh delete root@192.168.1.1

# 使用自定义配置
xssh delete -i /path/to/hosts.csv root@192.168.1.1
```

---

### 3️⃣ 查看主机信息

```bash
xssh show [-i config] [host]
```

功能：
* 列出所有已配置的主机
* 显示每个主机下的用户列表

示例：

```bash
# 查看所有主机（默认配置）
xssh show

# 查看所有主机（自定义配置）
xssh show -i /path/to/hosts.csv

# 查看指定主机
xssh show 192.168.1.1
```

---

## 六、匹配与查找规则（非常重要）

### 查找顺序

```text
1. 精确匹配 host
2. 在该 host 下精确匹配 user
```

---

### 不同场景下的行为

| 场景                      | 行为    |
| ----------------------- | ----- |
| host + user 唯一匹配        | 直接登录  |
| host 存在，user 不存在        | 报错并退出 |
| host 存在，user 未指定，只有一个用户 | 自动选择  |
| host 存在，user 未指定，多个用户   | 交互选择  |
| host 不存在                | 报错并退出 |

---

## 七、SSH 配置

xssh 使用以下 SSH 选项：
* `-tt`：强制分配伪终端
* `-o StrictHostKeyChecking=no`：忽略主机指纹验证
* `-o UserKnownHostsFile=/dev/null`：不保存主机密钥

> 这些配置简化了首次连接体验，但请注意安全风险。

---

## 八、错误与异常处理

xssh 在以下情况下会 **拒绝执行 SSH**：

* `hosts.csv` 不存在
* CSV 字段缺失或格式错误
* `(host, user)` 出现重复
* 密码字段为空
* 端口号非法

错误信息以 **明确、可读** 为原则，例如：

```text
ERROR: hosts.csv 中存在重复的 host+user 记录: root@192.168.1.1
```

---

## 九、SSH 行为说明（默认策略）

xssh 本质是 SSH 的封装，不修改系统 SSH 配置。

### 默认行为（建议）

* 使用密码方式登录
* 不要求 known_hosts 预先存在
* 不在终端或日志中输出密码

逻辑上等价于：

```text
sshpass → ssh → 目标主机
```

---

## 十、安全说明（请务必阅读）

⚠️ **重要提醒**

* `hosts.csv` 中的密码为 **明文存储**
* 该工具 **仅建议用于可信环境**
* 不适合用于多人共享账号的服务器

### 建议的安全实践

* 设置文件权限：

```bash
chmod 600 ~/.ssh/hosts.csv
```

* 不要提交 hosts.csv 到 Git
* 如需更高安全性，请使用 SSH Key

---

## 十一、非目标（明确不做的事情）

xssh **不会**：

* 自动生成或管理 SSH Key
* 自动修改 `~/.ssh/config`
* 自动写入 `known_hosts`
* 作为堡垒机或审计系统
* 提供远程密码同步能力

---

## 十二、可扩展方向（规划中）

未来可能支持：

* 🔐 password 字段加密存储
* 🗂️ 主机分组（group 字段）
* 🚀 批量执行命令
* 📦 导入 Ansible inventory
* 🔄 自动迁移为 key 登录

---

## 十三、一句话总结

> **xssh 是一个“像 ssh 一样使用、但不需要记密码”的本地 SSH 密码连接工具。**